(()=>{"use strict";const e=window.wp.blocks,t=JSON.parse('{"UU":"dmg/read-more-link"}'),s=window.wp.blockEditor,r=window.wp.element,o=window.wp.i18n,a=window.React,n=window.wp.components,i=window.ReactJSXRuntime;function l({page:e,totalPages:t,setPage:s}){return(0,i.jsxs)("div",{style:{marginTop:"1em"},children:[(0,i.jsx)(n.Button,{disabled:1>=e,onClick:()=>s(e=>e-1),children:(0,o.__)("Previous","dmg-read-more-link")}),(0,i.jsxs)("span",{style:{margin:"0 8px"},children:[(0,o.__)("Page","dmg-read-more-link")," ",e," ",(0,o.__)("of","dmg-read-more-link")," ",t]}),(0,i.jsx)(n.Button,{disabled:e>=t,onClick:()=>s(e=>e+1),children:(0,o.__)("Next","dmg-read-more-link")})]})}function d({search:e,data:t,selectedPost:r,setAttributes:a}){const{searchTerm:d,setSearchTerm:c,page:p,setPage:g}=e,{results:m,loading:u,totalPages:h,error:w}=t;return(0,i.jsx)(s.InspectorControls,{children:(0,i.jsxs)(n.PanelBody,{title:(0,o.__)("Select a Post","dmg-read-more-link"),initialOpen:!0,children:[(0,i.jsx)(n.TextControl,{label:(0,o.__)("Search by title or ID","dmg-read-more-link"),value:d,onChange:e=>{c(e),g(1)}}),u&&(0,i.jsx)(n.Spinner,{}),!u&&w&&(0,i.jsx)(n.Notice,{status:"error",isDismissible:!1,children:(0,o.__)("There was a problem fetching posts. Please try again.","dmg-read-more-link")}),!u&&0<m.length&&m.map(e=>(0,i.jsx)(n.Button,{variant:e.id===r?.postId?"primary":"secondary",onClick:()=>a({postId:e.id,postTitle:e.title.rendered,postUrl:e.link}),style:{display:"block",marginBottom:"6px"},children:e.title.rendered},e.id)),(0,i.jsx)(l,{page:p,totalPages:h,setPage:g})]})})}(0,e.registerBlockType)(t.UU,{edit:function({attributes:e,setAttributes:t}){const[n,l]=(0,r.useState)(""),[c,p]=(0,r.useState)(1),{results:g,loading:m,totalPages:u,error:h}=function(e,t){const[s,r]=(0,a.useState)([]),[o,n]=(0,a.useState)(!1),[i,l]=(0,a.useState)(1),[d,c]=(0,a.useState)(null);return(0,a.useEffect)(()=>{(async()=>{n(!0),c(null);try{let s="";s=e?/^\d+$/.test(e)?`/wp-json/wp/v2/posts/${e}?_fields=id,title,link`:`/wp-json/wp/v2/posts?search=${e}&page=${t}&per_page=5&_fields=id,title,link`:`/wp-json/wp/v2/posts?page=${t}&per_page=5&_fields=id,title,link`;const o=await fetch(s);if(!o.ok)throw new Error("Failed to fetch posts.");const a=/^\d+$/.test(e),n=a?[await o.json()]:await o.json(),i=a?1:parseInt(o.headers.get("X-WP-TotalPages"))||1;r(n),l(i)}catch(e){r([]),c(e.message)}finally{n(!1)}})()},[e,t]),{results:s,loading:o,totalPages:i,error:d}}(n,c),w=(0,s.useBlockProps)(),k={postId:e.postId,postTitle:e.postTitle,postUrl:e.postUrl},_={searchTerm:n,setSearchTerm:l,page:c,setPage:p},j={results:g,loading:m,totalPages:u,error:h};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d,{search:_,data:j,selectedPost:k,setAttributes:t}),(0,i.jsx)("div",{...w,children:k.postId?(0,i.jsxs)("p",{className:"dmg-read-more",children:[(0,o.__)("Read More:","dmg-read-more-link")," ",(0,i.jsx)("a",{href:k.postUrl,target:"_blank",rel:"noopener noreferrer",children:k.postTitle})]}):(0,i.jsx)("p",{className:"dmg-read-more",children:(0,o.__)("No post selected.","dmg-read-more-link")})})]})},save:function({attributes:e}){const{postUrl:t,postTitle:r}=e;return(0,i.jsxs)("p",{className:"dmg-read-more",...s.useBlockProps.save(),children:[(0,o.__)("Read More:","dmg-read-more-link")," ",(0,i.jsx)("a",{href:t,children:r})]})}})})();